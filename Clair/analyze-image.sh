DOCKER_USERNAME=$1
DOCKER_PASSWORD=$2
TARGET_IMAGE=$3
OUT_FILE=$4

TEMP_FILE_FOR_TEMPLATE=$(mktemp)

echo "Writing to temp file $TEMP_FILE_FOR_TEMPLATE"

cp -f /etc/clairctlworker/template-clairctl.yaml $TEMP_FILE_FOR_TEMPLATE
sed -i -e "s/FILE_PATH/$OUT_FILE/g" $TEMP_FILE_FOR_TEMPLATE

docker login -u "$DOCKER_USERNAME" -p "$DOCKER_PASSWORD"

docker pull $TARGET_IMAGE
clairctl --log-level Debug push --local $TARGET_IMAGE
clairctl --log-level Debug report --help --config $TEMP_FILE_FOR_TEMPLATE --format html