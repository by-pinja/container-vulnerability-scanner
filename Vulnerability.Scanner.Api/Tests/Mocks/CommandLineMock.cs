using System.IO;
using NSubstitute;
using Vulnerability.Scanner.Api.Shell;

namespace Vulnerability.Scanner.Api.Tests.Mocks
{
    public static class CommandLineMock
    {
        public static ICommandLine CreateDefault()
        {
            var mock = Substitute.For<ICommandLine>();
            SetupReturnValueFromDataFile(mock, "nodejs.klar.out.json", "node:latest");
            return mock;
        }

        private static void SetupReturnValueFromDataFile(ICommandLine mock, string fileName, string image)
        {
            var pathToJson =
                Path.GetFullPath(Path.Combine(
                    Path.GetDirectoryName(typeof(Startup).Assembly.Location), $"../../../Tests/Data/{fileName}"));

            mock.Run(Arg.Is<string>(x => x.Contains($"klar {image}"))).Returns(File.ReadAllText(pathToJson));
        }
    }
}