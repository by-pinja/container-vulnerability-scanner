server {
    listen       80;
    server_name  localhost;
    root /var/www;
    rewrite_log on;
    error_log /dev/stdout notice;

    default_type application/json; # If no content-type then assume JSON

    error_page 400 = @400;
    location @400 { return 400 '{"status":400,"message":"Bad request"}\n'; }

    error_page 401 = @401;
    location @401 { return 401 '{"status":401,"message":"Unauthorized"}\n'; }

    error_page 403 = @403;
    location @403 { return 403 '{"status":403,"message":"Forbidden"}\n'; }

    error_page 404 = @404;
    location @404 { return 404 '{"status":404,"message":"Resource not found"}\n'; }

    location / {
        rewrite /(.*) /$1  break;
        proxy_pass http://stableapi:80/;
    }

    location /v1/group {
        limit_except PUT {
            allow 1.2.3.4; # Allow a single remote host
            deny all; # Deny everyone else
        }

        rewrite /v1/group(.*) /$1  break;
        proxy_pass http://stableapi:80/;
    }
}
